openapi: 3.0.0
info:
  title: Conference Discovery & Research API
  description: REST API for discovering academic conferences and enriching them with research paper data
  version: 1.0.0
  contact:
    name: API Support
    
servers:
  - url: http://localhost:5000
    description: Development server
  - url: https://api.example.com
    description: Production server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      
  schemas:
    Conference:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        acronym:
          type: string
        description:
          type: string
        website:
          type: string
        location:
          type: string
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        country:
          type: string
        city:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        status:
          type: string
          enum: [scheduled, cancelled, postponed]
        created_at:
          type: string
          format: date-time
          
    Author:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        h_index:
          type: integer
        semantic_scholar_id:
          type: string
        affiliation:
          type: string
        last_updated:
          type: string
          format: date-time
          
    Paper:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        conference_id:
          type: integer
        authors:
          type: array
          items:
            $ref: '#/components/schemas/Author'
            
    Submission:
      type: object
      properties:
        id:
          type: integer
        type:
          type: string
          enum: [new_conference, cancellation, modification]
        status:
          type: string
          enum: [pending, approved, rejected]
        payload:
          type: object
        created_at:
          type: string
          format: date-time
          
    PaginatedResponse:
      type: object
      properties:
        items:
          type: array
        total:
          type: integer
        page:
          type: integer
        per_page:
          type: integer
        has_next:
          type: boolean
        has_prev:
          type: boolean
          
    MapCitiesResponse:
      type: object
      properties:
        points:
          type: array
          items:
            type: object
            properties:
              city:
                type: string
              country:
                type: string
              lat:
                type: number
              lng:
                type: number
              count:
                type: integer
        total_cities:
          type: integer
        total_conferences:
          type: integer
        filters:
          type: object

paths:
  /conferences:
    get:
      tags:
        - Conferences
      summary: List all conferences
      description: Get paginated list of conferences with optional search, filter, and sort
      parameters:
        - name: q
          in: query
          description: Search term (searches name and acronym)
          schema:
            type: string
          example: AI Conference
        - name: country
          in: query
          description: Filter by country
          schema:
            type: string
          example: France
        - name: sort_by
          in: query
          description: Sort field
          schema:
            type: string
            enum: [name, created_at, start_date]
          example: start_date
        - name: page
          in: query
          description: Page number (1-indexed)
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Results per page (1-100)
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PaginatedResponse'
                  message:
                    type: string

  /conferences/{conference_id}:
    get:
      tags:
        - Conferences
      summary: Get conference details
      parameters:
        - name: conference_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Conference details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Conference'
        '404':
          description: Conference not found

    put:
      tags:
        - Conferences
      summary: Update conference (Admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: conference_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                status:
                  type: string
                  enum: [scheduled, cancelled, postponed]
      responses:
        '200':
          description: Conference updated
        '403':
          description: Admin access required
        '404':
          description: Conference not found

    delete:
      tags:
        - Conferences
      summary: Delete conference (Admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: conference_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Conference deleted
        '403':
          description: Admin access required
        '404':
          description: Conference not found

  /authors:
    get:
      tags:
        - Authors
      summary: List all authors
      description: Get paginated list of authors, optionally filtered by name, sorted by h-index
      parameters:
        - name: name
          in: query
          description: Search author by name
          schema:
            type: string
          example: John Smith
        - name: page
          in: query
          description: Page number (1-indexed)
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Results per page (1-100)
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Authors list retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PaginatedResponse'

  /authors/{author_id}:
    get:
      tags:
        - Authors
      summary: Get author details
      parameters:
        - name: author_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Author details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      author:
                        $ref: '#/components/schemas/Author'
                      papers:
                        type: array
                        items:
                          $ref: '#/components/schemas/Paper'
        '404':
          description: Author not found

  /authors/{author_id}/refresh:
    post:
      tags:
        - Authors
      summary: Manually refresh author h-index (Admin only)
      description: Fetch fresh h-index data from Semantic Scholar
      security:
        - bearerAuth: []
      parameters:
        - name: author_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Author h-index refreshed
        '403':
          description: Admin access required
        '404':
          description: Author not found

  /authors/{author_id}/papers:
    get:
      tags:
        - Authors
      summary: Get papers by author
      parameters:
        - name: author_id
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          description: Results per page
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Papers retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      author:
                        $ref: '#/components/schemas/Author'
                      papers:
                        type: array
                        items:
                          $ref: '#/components/schemas/Paper'
        '404':
          description: Author not found

  /submissions:
    post:
      tags:
        - Submissions
      summary: Submit new conference
      description: Anonymous submission of new conference with papers and authors (enriches with h-index data)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - papers
              properties:
                name:
                  type: string
                  example: "AI Conference 2025"
                organizers:
                  type: string
                  example: "IEEE, ACM"
                location:
                  type: string
                  example: "Paris, France"
                featured_workshops:
                  type: string
                papers:
                  type: array
                  items:
                    type: object
                    properties:
                      title:
                        type: string
                      authors:
                        type: array
                        items:
                          type: string
      responses:
        '201':
          description: Submission received
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      submission_id:
                        type: integer
                      status:
                        type: string
                      enrichment_summary:
                        type: object

    get:
      tags:
        - Submissions
      summary: Get submission status
      description: Track submission by ID
      parameters:
        - name: id
          in: query
          required: true
          description: Submission ID to retrieve
          schema:
            type: integer
      responses:
        '200':
          description: Submission retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Submission'
        '400':
          description: Submission ID not provided or not found

  /admin/pending:
    get:
      tags:
        - Admin
      summary: List pending submissions (Admin only)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Pending submissions list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Submission'
        '403':
          description: Admin access required

    delete:
      tags:
        - Admin
      summary: Delete all pending submissions (Admin only)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: All pending submissions deleted
        '403':
          description: Admin access required

  /admin/pending/{submission_id}:
    put:
      tags:
        - Admin
      summary: Update pending submission (Admin only)
      description: Modify submission payload before approval
      security:
        - bearerAuth: []
      parameters:
        - name: submission_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  type: object
      responses:
        '200':
          description: Submission updated
        '400':
          description: Submission not in pending status
        '403':
          description: Admin access required

  /admin/approve:
    post:
      tags:
        - Admin
      summary: Approve submission and create conference (Admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - submission_id
              properties:
                submission_id:
                  type: integer
      responses:
        '200':
          description: Submission approved, conference created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Conference'
        '400':
          description: Submission already processed
        '403':
          description: Admin access required

  /admin/reject:
    post:
      tags:
        - Admin
      summary: Reject submission (Admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - submission_id
              properties:
                submission_id:
                  type: integer
                reason:
                  type: string
                  description: Reason for rejection
      responses:
        '200':
          description: Submission rejected
        '400':
          description: Submission already processed
        '403':
          description: Admin access required

  /login:
    post:
      tags:
        - Auth
      summary: Admin login
      description: Get JWT token for admin access
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "kacem@gmail.com"
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    description: JWT token for authentication
        '401':
          description: Invalid credentials

  /map/cities:
    get:
      tags:
        - Map
      summary: Get conferences by city
      description: Get list of cities with conference counts and coordinates, with optional date filtering
      parameters:
        - name: start_year
          in: query
          description: Filter conferences from this year onwards
          schema:
            type: integer
            example: 2020
        - name: end_year
          in: query
          description: Filter conferences up to this year
          schema:
            type: integer
            example: 2025
      responses:
        '200':
          description: Cities data retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MapCitiesResponse'
        '400':
          description: Invalid parameters

  /map:
    get:
      tags:
        - Map
      summary: Interactive map visualization
      description: HTML page with interactive Leaflet map showing conference locations
      responses:
        '200':
          description: Map HTML page
          content:
            text/html:
              schema:
                type: string

tags:
  - name: Conferences
    description: Conference data operations
  - name: Authors
    description: Author information and h-index operations
  - name: Submissions
    description: Submit and track new conference submissions
  - name: Admin
    description: Administrative operations (requires JWT authentication)
  - name: Auth
    description: Authentication
  - name: Map
    description: Geographic visualization
